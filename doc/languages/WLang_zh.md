<!--
#
# Copyright (c) 2015, Xin YUAN, courses of Zhejiang University
# All rights reserved.
#
# This program is free software; you can redistribute it and/or
# modify it under the terms of the 2-Clause BSD License.
#
# Author contact information:
#   yxxinyuan@zju.edu.cn
#
-->

# WLang语言

WLang语言是根据C++语言来设计的，吸收了C#、Java等语言的优点，专注于高层概念的构建，
适合多人协作开发，同时保持了C++高效执行的优点。

## 统一编程模型

计算机技术发展至今，已经深刻地改变了世界。计算机程序是计算机得以运转的基本要素。
计算机程序的运行本质上就是和计算机对话，向计算机要求计算资源，得到结果并呈现出来。
计算资源是一种服务，包括数据和算法，对应到计算机硬件的内存、硬盘 (它们存储数据)
以及CPU指令流 (它们执行算法)。数据和算法概念上是一体的，都是计算资源服务，
所以在软件设计上使用类来表示计算服务是合理的，因为类一般同时包含了数据和算法。
当然一个类也可以只包含数据，也可以只包含算法，并可以形成递归和嵌套。
WLang语言正是以类为核心来设计的。

由于计算资源服务统一被设计为类和类的实例对象，所以全局对象和孤立的函数失去了存在的必要，
可以用类的静态成员、静态方法来取代。这么做同时也是对全局对象和函数在概念上进行归类。

## 语法要素

### 注释

WLang的注释和C++相同，有/**/和//两种方式。

### 基本数据类型

WLang的基本数据类型如下表所示：

| 类型 | 说明 |
|-----|-----|
|char| 有符号字符类型，1个字节 |
|byte| 无符号字符类型，1个字节 |
|short| 有符号短整数，2个字节 |
|ushort| 无符号短整数，2个字节 |
|int| 有符号整数，4个字节 |
|uint| 无符号整数，4个字节 |
|int64| 有符号64位整数，8个字节 |
|uint64| 无符号64位整数，8个字节 |
|float| 单精度浮点数，4个字节 |
|double| 双精度浮点数，8个字节 |
|intptr| 指针类型的有符号整数，32位系统下是4字节，64位系统下是8字节 |
|uintptr| 指针类型的无符号整数，32位系统下是4字节，64位系统下是8字节 |
|bool| 布尔类型，占1个字节 |
|guid| 全局唯一标识符，占16个字节 |

其中，bool类型的取值是两个标准值：true和false，bool类型的变量本身就是逻辑表达式，
取值为false时为假，反之为真。

### 复合类型

由基本类型或复合类型组合的数据类型。WLang有两种复合类型：数组和类。数组本质上也是
一种“类”，不过是按重复模式构造出来的类型。类是一种用户可自由扩展定义的模式。基本类型
也可看成是“类”，因而类 (class) 是统一的类型。

由于需要对数组的元素进行各种操作，有可能对同一种元素要施行不同的操作，如对字符串类型
进行大小写敏感和不敏感的比较，因此将数组类型定义为特殊模板形式。

数组可如下定义：

```
//固定长度的数组
A[10] a;
A[10]<SpecialCompareTrait<A>> a;
//动态数组
share A[] a;
weak A[] a2;
```

枚举是一种特殊的类型，本身是整数类型，但只能取规定好的值的集合。枚举可如下定义：

```
enum StreamOpenFlags
{
	Read = 0x00000001U;
...
}
```

类和接口将在下面详述。

### 常量

每种类型都可能有常量，除了share类型和share数组。基本数据类型的常量如下表所示：

|类型|说明|
|---|---|
|char,short,int,int64,intptr|数字|
|byte,ushort,uint,uint64,uintptr|数字+后缀U|
|float|数字+小数点+数字+可选的指数部分+后缀f|
|double|无后缀浮点数表示|
|guid|{8位数字-4位数字-4位数字-4位数字-12位数字}|

常量用十六进制表示时，使用0x前缀。

常量可如下定义:

```
const int c_Num(5);
```

复合类型常量可以用花括号列表来定义，项之间可以用逗号隔开。花括号列表可以嵌套。

对于常量数组，其定义如下：

```
const int[] c_arr = { 0, 1, 2 };
```

常量可以定义在类中，类似static，也可以定义在方法体中。

字符串常量使用一对引号来定义。

转义字符：

|符号|描述|值|
|---|---|---|
|\a| 响铃(BEL) | 007 |
|\b| 退格(BS) | 008 |
|\f| 换页(FF) | 012 |
|\n| 换行(LF) | 010 |
|\r| 回车(CR) | 013 |
|\t| 水平制表(HT) | 009 |
|\v| 垂直制表(VT) | 011 |
|\\| 反斜杠 | 092 |
|\'| 单引号 | 039 |
|\"| 双引号 | 034 |
|\0| 空字符 | 000 |
|\ddd| 1至3位八进制数 | 3位八进制数 |
|\xhh| 1至2位十六进制数 | 2位十六进制数 |

### 名字空间

名字空间把类按概念组织成层次结构，自身也可以嵌套地定义。
名字空间可以看成是一种退化的类。
WLang语言规定，其类定义都要处于一个名字空间中。

名字空间如下定义：

```
namespace UI {
...
}
```

### 类和对象

类是提供服务的基本单位，是统一的编程模型。对象是类的实例。

类本身在名字空间中具有一个修饰说明，可以是private和public两种之一，分别代表
名字空间内可见以及名字空间外可见。

在类中，可以定义嵌套类，从而形成概念上的层次结构。

类由属性、方法、事件三种元素组成。属性和方法具有三种可见性修饰，private、protected
和public。事件由一个或多个接口组成，用event关键字说明。触发事件使用fire关键字。

成员对象和静态成员对象。

方法的声名末尾可以加上nothrow修饰，以声明它不会抛出异常。

方法可以带有static修饰符，以声明它是静态的，和类的实例无关。

方法的参数具有in, out, inout修饰，传递的是引用。返回值是对象的值传递。

方法内也可以嵌套定义类。

继承关系，允许多重继承，允许多个基类相同，此时一定要加上别名说明，调用方法使用别名
和::作为域限制符。覆盖实现基类的某个方法时，也可以加上域限制符，并使用override修饰符。

只有公有继承。

类和类的方法都可以设计成模板形式，模板参数可以是类型、整数常量和枚举常量。

类的对象除了直接定义外，还可以定义成引用ref T，共享对象share T以及弱对象weak T。
ref T的获取和传递要确保生命周期内的有效性。这三类引用对象都不能直接定义对象，只能通过
包装类的属性来间接访问，属性可以设计引用属性(ref,share,weak)和自身属性(包括数组类型)
两种。share T和weak T不能获得ref T对象。

对象的内存模型：
类一般通过对象实例来运行，除了静态成员方法。
类对象运行时将占据内存，其数据部分在使用中形成内存布局，除了静态成员对象。

|进程内存管理|描述|
|---|---|
|栈|方法内定义的变量，包括一般对象、引用对象、共享对象和弱对象|
|堆|共享对象、弱对象和部分引用对象管理的内存|
|全局数据段|静态对象或静态常对象、类的静态成员变量|
|全局未初始化数据段|方法内的静态对象|

对象的运行模型：
在程序运行时，对象所管理的数据可以不局限于内存，也可以是设备上的内存，如显卡显示内存等。
对象也可以管理磁盘文件等永久存储数据，或者虚拟概念上的存储数据。

|进程内|描述|
|---|---|
|内核空间|各种内核对象，如共享内存对象。暂时不支持驱动程序设计|
|装配件|对象占用所在进程的堆和栈|
|可执行装配件|对象占用所在进程的堆和栈|

|进程外|描述|
|---|---|
|远程装配件|代理对象占用所在进程的堆和栈，服务对象占用本地或远程计算机host进程的堆和栈|

对象的复制，等号或者拷贝构造、转移构造等全部缺省实现。引用对象缺省行为是被管理对象，
如果要对引用本身操作，使用ref()操作符来获得引用语义(浅拷贝)。如果要复制一个对象，使用clone
操作符(深拷贝)。判断是否空对象，使用is_null()操作符。

数据类型转换，as操作符。转换到其他基本类型；转换到基类；转化到派生类(通过模板参数)；
ref,share,weak的直接转换。组件对象也可以有as，内部实现为query。

可以自定义构造方法。一般构造、拷贝构造、转移构造、赋值操作符、转移赋值操作符、析构均自动实现。

返回值可以是`weak ref`，用于封装第三方库的时候。

异常

### 接口

接口内包含属性和方法，无需进行可见性说明，它们均为公开的。接口由interface关键字来定义。

派生类可以以接口为基类，实现接口方法，包括属性的方法时，需要加上override修饰。

实现回调机制。

### 组件

进程内组件和进程外组件，局域网组件，网络组件。

支持as操作符，获得组件支持的其他接口。

实现多种事件集，连接点。观察者模式。

散集和列集。

实现插件系统。

## 基础类库


### 数据结构

System名字空间，允许intptr,uintptr和ref T的转化。使用MemoryPool基础类。本身符合
生命周期规定。

迭代器，数组和其他数据结构均可以有。使用auto_type关键字定义迭代器对象。

### 线程和同步

在应用层做。

线程间同步

几种线程模型

### 进程和同步

进程间同步

进程间通讯

## 工程类型

### 应用

### 类库

类库文件名带有版本号。
